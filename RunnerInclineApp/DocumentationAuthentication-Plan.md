# Authentication Integration Plan - Sprint 2.5

## 🎯 Goal
Add Sign in with Apple authentication to secure course uploads and provide user ownership.

## 📋 Implementation Steps

### 1. Update Course Model
```swift
struct Course: Identifiable, Codable {
    let id: UUID
    let name: String
    let city: String?
    let distance_miles: Double?
    let total_elevation_gain_ft: Double?
    let gpx_url: String?
    let source_type: String?
    let source_link: String?
    let verified: Bool
    let created_at: String?
    let created_by: UUID?  // New field
}
```

### 2. Create AuthenticationManager
- Sign in with Apple integration
- Supabase auth session management
- User state persistence

### 3. Update SupabaseService
- Include `created_by` field in course creation
- Handle authenticated requests
- Manage auth tokens

### 4. Update UI Flow
- Add authentication gate before upload
- Show user profile/sign out options
- Handle unauthenticated states

### 5. Enhanced Security
- Only show user's own unverified courses
- Admin verification workflow
- Proper RLS policies

## 🔐 Authentication Flow

```
User opens app
    ↓
Browse public verified courses (no auth needed)
    ↓
User wants to upload course
    ↓
Show Sign in with Apple
    ↓
Authenticated → Allow upload
    ↓
Course created with user ID
    ↓
Segments generated by Edge Function
    ↓
User can see their course (unverified)
    ↓
Admin can verify course → becomes public
```

## 📱 UI Components to Create
- `AuthenticationView` - Sign in with Apple
- `UserProfileView` - Profile management
- `AuthenticationManager` - Auth state management
- Updated `GPXUploadView` - Auth-required upload

## 🚀 Benefits
- ✅ Secure course creation
- ✅ User ownership tracking  
- ✅ Spam prevention
- ✅ Admin moderation capability
- ✅ Personalized experience